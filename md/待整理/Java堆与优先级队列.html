<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java堆与优先级队列 | My vuepress</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <script src="https://hm.baidu.com/hm.js?xxxxxxxxxxx"></script>
    <meta name="description" content="Todo">
    <meta name="robots" content="all">
    <meta name="author" content="pdai">
    <meta name="keywords" content="Java 全栈知识体系, java体系, java知识体系, java框架,java详解,java学习路线,java spring, java面试, 知识体系, java技术体系, java编程, java编程指南,java开发体系, java开发,java教程,java,java数据结构, 算法, 开发基础">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="preload" href="/assets/css/0.styles.144ea653.css" as="style"><link rel="preload" href="/assets/js/app.afcd353c.js" as="script"><link rel="preload" href="/assets/js/2.6527dd7c.js" as="script"><link rel="preload" href="/assets/js/64.1abf1796.js" as="script"><link rel="prefetch" href="/assets/js/10.b8af9589.js"><link rel="prefetch" href="/assets/js/11.da070787.js"><link rel="prefetch" href="/assets/js/12.e8c2df3f.js"><link rel="prefetch" href="/assets/js/13.13f8690b.js"><link rel="prefetch" href="/assets/js/14.97d7a7c6.js"><link rel="prefetch" href="/assets/js/15.ca82dd18.js"><link rel="prefetch" href="/assets/js/16.0795663b.js"><link rel="prefetch" href="/assets/js/17.9f529ede.js"><link rel="prefetch" href="/assets/js/18.aa494d1d.js"><link rel="prefetch" href="/assets/js/19.c5e368a6.js"><link rel="prefetch" href="/assets/js/20.8486962d.js"><link rel="prefetch" href="/assets/js/21.1a96e733.js"><link rel="prefetch" href="/assets/js/22.5b4929c3.js"><link rel="prefetch" href="/assets/js/23.7bc228ce.js"><link rel="prefetch" href="/assets/js/24.63116242.js"><link rel="prefetch" href="/assets/js/25.e9163e8b.js"><link rel="prefetch" href="/assets/js/26.31132baf.js"><link rel="prefetch" href="/assets/js/27.728265df.js"><link rel="prefetch" href="/assets/js/28.4cb93316.js"><link rel="prefetch" href="/assets/js/29.30a99cb0.js"><link rel="prefetch" href="/assets/js/3.e3c760c5.js"><link rel="prefetch" href="/assets/js/30.39c64819.js"><link rel="prefetch" href="/assets/js/31.78e9d272.js"><link rel="prefetch" href="/assets/js/32.e71f2609.js"><link rel="prefetch" href="/assets/js/33.b182a570.js"><link rel="prefetch" href="/assets/js/34.d919b2af.js"><link rel="prefetch" href="/assets/js/35.e2cdb183.js"><link rel="prefetch" href="/assets/js/36.759e107d.js"><link rel="prefetch" href="/assets/js/37.a0ccb526.js"><link rel="prefetch" href="/assets/js/38.8f8ec90d.js"><link rel="prefetch" href="/assets/js/39.bcb56569.js"><link rel="prefetch" href="/assets/js/4.e1e5a770.js"><link rel="prefetch" href="/assets/js/40.cb9e68d1.js"><link rel="prefetch" href="/assets/js/41.f7324d34.js"><link rel="prefetch" href="/assets/js/42.fbc4875e.js"><link rel="prefetch" href="/assets/js/43.602efb90.js"><link rel="prefetch" href="/assets/js/44.5cdea7dd.js"><link rel="prefetch" href="/assets/js/45.08b55f16.js"><link rel="prefetch" href="/assets/js/46.89b660d7.js"><link rel="prefetch" href="/assets/js/47.8041c4a7.js"><link rel="prefetch" href="/assets/js/48.54a6e067.js"><link rel="prefetch" href="/assets/js/49.63fc5fb5.js"><link rel="prefetch" href="/assets/js/5.b9a4a83e.js"><link rel="prefetch" href="/assets/js/50.defc28ad.js"><link rel="prefetch" href="/assets/js/51.01fa48a2.js"><link rel="prefetch" href="/assets/js/52.04cb5e30.js"><link rel="prefetch" href="/assets/js/53.b04e4c27.js"><link rel="prefetch" href="/assets/js/54.a99c8dca.js"><link rel="prefetch" href="/assets/js/55.f15500bf.js"><link rel="prefetch" href="/assets/js/56.c9d0f497.js"><link rel="prefetch" href="/assets/js/57.eb7e4183.js"><link rel="prefetch" href="/assets/js/58.4a5207ff.js"><link rel="prefetch" href="/assets/js/59.8620aeb6.js"><link rel="prefetch" href="/assets/js/6.ddfdb723.js"><link rel="prefetch" href="/assets/js/60.a1b1dae5.js"><link rel="prefetch" href="/assets/js/61.e6ec84e2.js"><link rel="prefetch" href="/assets/js/62.8703dde9.js"><link rel="prefetch" href="/assets/js/63.76d6c8fe.js"><link rel="prefetch" href="/assets/js/65.7430076b.js"><link rel="prefetch" href="/assets/js/66.9ca1a22b.js"><link rel="prefetch" href="/assets/js/67.aeba61a8.js"><link rel="prefetch" href="/assets/js/68.81e8ae85.js"><link rel="prefetch" href="/assets/js/69.fb8f7d5d.js"><link rel="prefetch" href="/assets/js/7.6689766d.js"><link rel="prefetch" href="/assets/js/70.f55dc26a.js"><link rel="prefetch" href="/assets/js/71.d310670d.js"><link rel="prefetch" href="/assets/js/72.d0b65202.js"><link rel="prefetch" href="/assets/js/73.fbee5211.js"><link rel="prefetch" href="/assets/js/74.952412ed.js"><link rel="prefetch" href="/assets/js/75.2f6086aa.js"><link rel="prefetch" href="/assets/js/76.7b2a8f50.js"><link rel="prefetch" href="/assets/js/77.f75ad0d8.js"><link rel="prefetch" href="/assets/js/8.1f4717e3.js"><link rel="prefetch" href="/assets/js/9.a70f9ef6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.144ea653.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">My vuepress</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/java/base/Base.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/md/about/并发编程.html" class="nav-link">
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/md/java/base/Base.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/md/about/并发编程.html" class="nav-link">
  关于
</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p>堆可以高效的解决以下问题：</p> <ol><li>优先级队列，队列中优先级高的先被处理</li> <li>求前K个最大的元素，元素个数不确定，数据列可能很大，甚至源源不断。变体有：求前K个最小的元素，第K个最大的元素
不直接排序的原因是，因为数据列很大，堆不需要全部排序即可找出当前最大或最小的数。</li> <li>求中值元素，中值不是平均值，而是排序后中间那个元素的值。同样适用于数据列很大的场景。
</li></ol> <h1 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h1> <p>堆首先是一个二叉树，而且是<code>完全二叉树</code>。</p> <p>先看一个相似的概念：满二叉树
满二叉树指除了最后一层外，每个节点都有两个孩子</p> <p>完全二叉树：
不要求最后一层是满的，但如果不满,则要求所有节点必须几种在最左边。从左到右是连续的中间不能有空的。
<img src="/images/ref/%E5%A0%8601.png" alt="Alt text"></p> <p>在完全二叉树中，可以给每个节点一个编号,编号从1开始连续递增，从上到下，从左到右。
<img src="/images/ref/%E5%A0%8602.png" alt="Alt text"> <code>完全二叉树有一个重要的特点：给定任意一个节点，可以根据其编号直接快速计算出其父节点和孩子节点编号</code>。
如果编号为i，则父节点编号为i/2,左孩子编号为2<em>i,右孩子编号为2</em>i+1。</p> <p>这样就可以使得逻辑概念上的二叉树可以方便地存储到数组中，树中的父子关系通过索引关系隐含维持，不需要单独保持。
<img src="/images/ref/%E5%A0%8603.png" alt="Alt text"></p> <p>在堆中，可以有重复元素，元素间不是完全有序的，但对于父子节点之间，有一定的顺序要求。
根据顺序分为两种堆：最大堆，最小堆。</p> <p>最大堆是指每个节点都不大于其父节点。这样对于每个父节点，一定不小于其所有孩子节点，二根节点就是所有节点中最大的。</p> <p>总结：逻辑概念上，堆是完全二叉树，父子节点间有特定顺序，分为最大堆与最下堆，使用数组进行物理存储。</p> <h1 id="堆的算法"><a href="#堆的算法" class="header-anchor">#</a> 堆的算法</h1> <p>以最小堆来说明</p> <h2 id="添加元素"><a href="#添加元素" class="header-anchor">#</a> 添加元素</h2> <p>如果堆为空，直接添加一个根。假设已经有一个不为空的堆，要添加元素：</p> <ol><li>添加元素到最后位置</li> <li>与父节点比较，如果大于等于父节点，则结束。否则与父节点进行交换，然后再比较...直到父节点为空或者大于等于父节点</li></ol> <p>这种自底向上比较、交换，使得树重新满足堆的性质的过程，称为向上调整(siftup)</p> <h2 id="从头部删除元素"><a href="#从头部删除元素" class="header-anchor">#</a> 从头部删除元素</h2> <ol><li>用最后一个元素替换头部元素，并删掉最后一个元素</li> <li>将新的头部与两个孩子节点中较小的比较，如果不大于则结束。否则，与较小的孩子节点进行交换，交换后继续比较...</li></ol> <p>这个过程称为向下调整(siftdown)</p> <h2 id="从中间删除元素"><a href="#从中间删除元素" class="header-anchor">#</a> 从中间删除元素</h2> <ol><li>先用最后一个元素替换待删元素</li> <li>如果该元素大于某孩子节点，向下调整。如果该元素小于父节点，向上调整</li></ol> <h2 id="构建初始堆"><a href="#构建初始堆" class="header-anchor">#</a> 构建初始堆</h2> <p>给定一个无序数组，如何使之称为一个最小堆呢？这个过程称为heapify，基本思路：
从最后一个非叶子节点开始(size/2)，一直到根节点，对每个节点执行向下调整。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">heapity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
        <span class="token function">siftdown</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="查找和遍历"><a href="#查找和遍历" class="header-anchor">#</a> 查找和遍历</h2> <p>就是对数组的遍历</p> <h1 id="priorityqueue"><a href="#priorityqueue" class="header-anchor">#</a> PriorityQueue</h1> <p>PriorityQueue优先级队列，内部是用堆实现的，内部元素不完全有序，不过逐个出队会得到有序的输出。
虽然名字叫优先级队列，也可以当做一种比较通用的实现了堆的性质的数据结构，可以用来解决适合用堆解决的问题。</p> <h2 id="求前k个最大的元素"><a href="#求前k个最大的元素" class="header-anchor">#</a> 求前K个最大的元素</h2> <p>简单思路：排序
如果K很小，直接取最大值就好了，对所有元素排序毫无必要</p> <p>简单思路2：循环K次，每次从剩下的元素中选择最大值
这两个思路都假定所有元素都是已知的，而不是动态添加的。如果元素个数不确定而且源源不断到来呢？</p> <p>思路： 维护一个长度为K的数组，最前面的K个元素就是目前最大的K个元素，后来的新元素都现找出数组中的最小值将新元素与最小值比较，如果小于最小值不变。如果大于最小值，则替换元素。
缺点是每次都需要找出最小值，需要进行K次比较</p> <p>用堆来解决：用最小堆维护这K个元素，根永远是最小的，新来的元素与根比较就可以了。如果小于根不需变化，否则替换根元素，向下调整。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/realpdai/tech-arch-doc/edit/master/md/待整理/Java堆与优先级队列.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-6-26 17:00:44</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.afcd353c.js" defer></script><script src="/assets/js/2.6527dd7c.js" defer></script><script src="/assets/js/64.1abf1796.js" defer></script>
  </body>
</html>
